# Ansible Configuration Documentation

## Overview
This directory contains Ansible playbooks and roles for deploying Docker on Yandex Cloud VMs.
The Yandex Cloud because I more familiar with this, then with aws

## Directory Structure as you requested
```
ansible/
├── inventory/
│   └── default_ya.yml
├── playbooks/
│   └── dev/
│       └── main.yaml
├── roles/
│   └── docker/
│       ├── defaults/
│       │   └── main.yml
│       ├── handlers/
│       │   └── main.yml
│       ├── tasks/
│       │   ├── install_docker.yml
│       │   ├── install_compose.yml
│       │   └── main.yml
│       └── README.md
└── ansible.cfg
```

## Inventory Information

### Inventory Structure
```bash
$ ansible-inventory -i inventory/default_ya.yml --list
{
    "_meta": {
        "hostvars": {
            "yandex_vm": {
                "ansible_host": "84.201.141.229",
                "ansible_python_interpreter": "/usr/bin/python3",
                "ansible_ssh_private_key_file": "~/.ssh/id_rsa",
                "ansible_user": "ubuntu"
            }
        }
    },
    "all": {
        "children": [
            "ungrouped"
        ]
    },
    "ungrouped": {
        "hosts": [
            "yandex_vm"
        ]
    }
}
```

### Inventory Visualization
```bash
$ ansible-inventory -i inventory/default_ya.yml --graph
@all:
  |--@ungrouped:
  |  |--yandex_vm
```

## Deployment Output

### Dry Run (Check Mode)
```bash
$ ansible-playbook -i inventory/default_ya.yml playbooks/dev/main.yaml --check

PLAY [Deploy Docker on Yandex Cloud VM] ********************************************************************

TASK [Gathering Facts] *************************************************************************************
ok: [yandex_vm]

TASK [../../roles/docker : Update apt package index] *******************************************************
changed: [yandex_vm]

TASK [../../roles/docker : Install prerequisites for Docker] ***********************************************
ok: [yandex_vm]

TASK [../../roles/docker : Add Docker's official GPG key] **************************************************
ok: [yandex_vm]

TASK [../../roles/docker : Add Docker repository] **********************************************************
ok: [yandex_vm]

TASK [../../roles/docker : Install Docker CE] **************************************************************
ok: [yandex_vm]

TASK [../../roles/docker : Ensure Docker service is started and enabled] ***********************************
ok: [yandex_vm]

TASK [../../roles/docker : Add current user to docker group] ***********************************************
ok: [yandex_vm]

TASK [../../roles/docker : Download Docker Compose] ********************************************************
ok: [yandex_vm]

TASK [../../roles/docker : Verify Docker Compose installation] *********************************************
skipping: [yandex_vm]

PLAY RECAP *************************************************************************************************
yandex_vm                  : ok=9    changed=1    unreachable=0    failed=0    skipped=1    rescued=0    ignored=0
```

### Actual Deployment
```bash
$ ansible-playbook -i inventory/default_ya.yml playbooks/dev/main.yaml
```

## Role Documentation

### Docker Role
The Docker role installs and configures Docker and Docker Compose on Ubuntu systems.

#### Features
- Installs Docker CE from the official Docker repository
- Installs Docker Compose v2.24.5
- Configures Docker to start on boot
- Adds the current user to the docker group
- Installs required Python packages for Docker management
- Creates necessary directories for Docker Compose

#### Requirements
- Ansible 2.9+
- Ubuntu 22.04 or later
- SSH access to the target machine
- Sudo privileges on the target machine

#### Variables
- `docker_version`: The version of Docker to install
- `docker_compose_version`: The version of Docker Compose to install
- `docker_compose_url`: The url to current Docker Compose source
all defaults are defined 

## Usage

1. Ensure you have the correct SSH key in place (`~/.ssh/id_rsa`) or it would be generated by terraform 
2. Run the playbook from root project directory
   ```bash
   ansible-playbook -i inventory/default_ya.yml playbooks/dev/main.yaml
   ```